---
title: "Forecasting Heart Disease Risks"
output: 
  html_document:
    theme:
      bg: "#1b1b1b"
      fg: "#FDF7F7" 
      primary: "#98002E"
      base_font:
        google: Montserrat
      code_font:
        google: JetBrains Mono
    highlight: espresso
    css: "resources/styles.css"
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: false
---


```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=6)

# Set default CRAN mirror
options(repos = c(CRAN = "https://cloud.r-project.org"))

#Install the following libraries if required
# List of required packages
required_pkgs <- c("tidyverse", "RCurl", "caret", "randomForest",
                   "e1071", "rpart", "corrplot", "GGally", "pROC")

# Install and load each package
for (pkg in required_pkgs) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    install.packages(pkg)
  }
  library(pkg, character.only = TRUE)
}

```

## Introduction



<br>

## Business Understanding
### Problem statement
To develop models for an insurance company using the Heart Disease dataset from the UCI Machine Learning Repository. The goal is to predict the likelihood of a person developing heart disease, which would help the insurance company estimate health risks and adjust premiums accordingly.


<br>

## Data Understanding
The dataset contains various features related to patients' health and demographic information. We will explore the dataset to understand its structure and relationships between variables.

### Data dictionary
The dataset contains 14 key attributes that are either numerical or categorical.

| Attribute	| Type	| Description	| Constraints/ Rules |
|:----------|:------|:------------|:-------------------|
| `age`	| Numerical	| The age of the patient in years	| Range: 29-77 (based on dataset statistics) |
| `sex`	| Categorical	| The gender of the patient	| Values: 1 = Male, 0 = Female |
| `cp` | Categorical	| Type of chest pain experienced by the patient | 	Values: 1 = Typical angina, 2 = Atypical angina, 3 = Non-anginal pain, 4 = Asymptomatic |
| `trestbps`	| Numerical	| Resting blood pressure of the patient, measured in mmHg	| Range: Typically, between 94 and 200 mmHg |
| `chol` | Numerical	| Serum cholesterol level in mg/dl | Range: Typically, between 126 and 564 mg/dl |
| `fbs`	| Categorical	| Fasting blood sugar level > 120 mg/dl | 	Values: 1 = True, 0 = False |
| `restecg` | Categorical	| Results of the patientâ€™s resting electrocardiogram	| Values: 0 = Normal, 1 = ST-T wave abnormality, 2 = Probable or definite left ventricular hypertrophy |
| `thalach`	| Numerical	| Maximum heart rate achieved during a stress test | Range: Typically, between 71 and 202 bpm |
| `exang`	| Categorical	| Whether the patient experiences exercise-induced angina	| Values: 1 = Yes, 0 = No |
| `oldpeak`	| Numerical	| ST depression induced by exercise relative to rest (an ECG measure)	| Range: 0.0 to 6.2 (higher values indicate more severe abnormalities) |
| `slope`	| Categorical	| Slope of the peak exercise ST segment	| Values: 1 = Upsloping, 2 = Flat, 3 = Downsloping |
| `ca` | Numerical	| Number of major vessels colored by fluoroscopy	| Range: 0-3 |
| `thal` | Categorical	| Blood disorder variable related to thalassemia	| Values: 3 = Normal, 6 = Fixed defect, 7 = Reversible defect |
| `target` | Categorical	| Diagnosis of heart disease	| Values: 0 = No heart disease, 1 = Presence of heart disease |


<br>

## Data Preparation
### Data loading
Load the dataset from the UCI website to memory
```{r}
# Load the dataset
url <- "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data"

# Read the dataset into a dataframe
Heart.df <- read.csv(text = getURL(url), header = FALSE, na.strings = "?")
```

Rename the columns into a meaningful column names
```{r}
colnames(Heart.df) <- c("age", "sex", "cp", "trestbps", "chol", "fbs",
                        "restecg", "thalach", "exang", "oldpeak", 
                        "slope", "ca", "thal", "target")
```

Display dimensions of the dataset
```{r}
dim(Heart.df)
```

Display the first six rows of the dataset
```{r}
head(Heart.df)
```

Display the structure of the dataframe
```{r}
glimpse(Heart.df)
```

Display the statistical summary of the dataframe
```{r}
summary(Heart.df)
```

### Data preprocessing
We will preprocess the data by handling missing values, encoding categorical variables, and scaling numerical features.

Convert binary variables to 0's and 1's.
```{r}
Heart.df$target <- ifelse(Heart.df$target > 0, 1, 0)
Heart.df$sex <- ifelse(Heart.df$sex > 0, 1, 0)
Heart.df$fbs <- ifelse(Heart.df$fbs > 0, 1, 0)
Heart.df$exang <- ifelse(Heart.df$exang > 0, 1, 0)
```

Handle missing values in `ca` and `thal` variables using mean/mode imputation.
```{r}
Heart.df$ca[is.na(Heart.df$ca)] <- median(Heart.df$ca, na.rm = TRUE)
Heart.df$ca[Heart.df$ca == "?"] <- median(Heart.df$ca, na.rm = TRUE)
#Heart.df$thal[is.na(Heart.df$thal)] <- median(Heart.df$thal, na.rm = TRUE)
Heart.df$ca[Heart.df$thal == "?"] <- median(Heart.df$thal, na.rm = TRUE)
```

Check for missing values if still exist
```{r}
sapply(Heart.df, function(x) sum(is.na(x)))
```

Check for duplicate entries and print them if they exist.
```{r}
dupes <- Heart.df[duplicated(Heart.df) | duplicated(Heart.df, fromLast = TRUE), ]
# Print or inspect the duplicate entries
print(dupes)
```

Convert categorical variables to factor.
```{r}
Heart.df$sex <- factor(Heart.df$sex, 
                       levels = c(0, 1), 
                       labels = c("Female", "Male"))
Heart.df$cp <- factor(Heart.df$cp, 
                      levels = c(1, 2, 3, 4), 
                      labels = c("Typical Angina", "Atypical Angina", 
                                 "Non-Angina", "Asymptomatic"))
Heart.df$fbs <- factor(Heart.df$fbs, 
                       levels = c(0, 1), 
                       labels = c("False", "True"))
Heart.df$restecg <- factor(Heart.df$restecg, 
                           levels = c(0, 1, 2), 
                           labels = c("Normal", "Wave-abnormality", "Probable"))
Heart.df$exang <- factor(Heart.df$exang, 
                         levels = c(0, 1), 
                         labels = c("No", "Yes"))
Heart.df$slope <- factor(Heart.df$slope, 
                         levels = c(1, 2, 3), 
                         labels = c("Upsloping", "Flat", "Downsloping"))
Heart.df$thal <- factor(Heart.df$thal, 
                        levels = c(3, 6, 7), 
                        labels = c("Normal", "Fixed Defect", "Reversible"))
Heart.df$target <- factor(Heart.df$target, 
                          levels = c(0, 1), 
                          labels = c("No", "Yes"))
```

### Exploratory data analysis
Plot distribution of `target` variable.
```{r}
ggplot(Heart.df, aes(x=target, fill=target)) +
  geom_bar() + theme_test() +
  labs(title="Distribution of Heart Disease",
       x = "Heart Disease", fill = "Heart Disease")
```

Visualize `age` distribution by heart disease presence.
```{r}
ggplot(Heart.df, aes(x = age, fill = as.factor(target))) + 
  geom_histogram(bins = 15) + theme_test() +
  labs(title = "Age Distribution by Heart Disease", 
       x = "Age", fill = "Heart Disease")
```

Visualize `chol` distribution by heart disease.
```{r}
ggplot(Heart.df, aes(x = chol, fill = target)) + 
  geom_histogram(bins = 15) + theme_test() +
  labs(title = "Cholesterol Distribution by Heart Disease", 
       x = "Cholesterol", fill = "Heart Disease")
```

Visualize `tresbps` distribution by heart disease.
```{r}
ggplot(Heart.df, aes(x = trestbps, fill = as.factor(target))) + 
  geom_histogram(bins = 15) + theme_test() +
  labs(title = "Resting Blood Pressure Distribution by Heart Disease", 
       x = "Resting Blood Pressure", fill = "Heart Disease")
```







<br>

## Modeling



<br>

## Evaluation



<br>

## Deployment


<br>

## Conclusion

